async function fetchData(isBackground) {
            const refreshIcon = document.getElementById('refreshIcon');
            
            // 1. ★★★ INSTANT LOAD (แสดงของเก่าก่อนเลย) ★★★
            // ถ้าเป็นการโหลดครั้งแรก (ไม่ใช่กด Refresh เอง) ให้เอาของเก่ามาโชว์ก่อน
            if (!isBackground) {
                const cachedData = localStorage.getItem('sadao_queue_cache');
                if (cachedData) {
                    try {
                        const parsed = JSON.parse(cachedData);
                        console.log("Loading from Local Cache...");
                        // แสดงข้อมูลเก่าไปพลางๆ
                        if(parsed.data) {
                            allData = parsed.data;
                            setupFilter(allData); 
                            filterData();
                            document.getElementById('lastUpdate').innerText = `CACHED DATA`;
                        }
                    } catch (e) {}
                }
                if(refreshIcon) refreshIcon.classList.add('spin-slow');
            }

            try {
                // 2. โหลดของจริงจาก Server
                const res = await fetch(API_URL + "?date=today&t=" + new Date().getTime());
                const json = await res.json();
                
                if(json.status === 'success') {
                    allData = json.data;
                    const now = new Date();
                    document.getElementById('lastUpdate').innerText = `UPDATED: ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}`;
                    if(json.date) document.getElementById('pageTitle').innerText = `ตารางคิววันที่ ${json.date}`;
                    
                    setupFilter(allData); 
                    filterData(); 

                    // 3. ★★★ บันทึกลง Local Cache สำหรับครั้งหน้า ★★★
                    localStorage.setItem('sadao_queue_cache', JSON.stringify(json));
                } else {
                    // ถ้า Server Error ก็ยังดีที่มีข้อมูลเก่าค้างหน้าจอ
                    console.error("Server Error:", json.message);
                }
            } catch(e) { 
                console.error("Network Error:", e);
            } 
            finally { 
                if(refreshIcon) refreshIcon.classList.remove('spin-slow'); 
            }
        }
